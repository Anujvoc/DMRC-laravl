/**
 * Sortable.js - Minimal implementation for drag and drop functionality
 * Basic drag and drop functionality for admin dashboard
 */

window.Sortable = window.Sortable || {};

Sortable.create = function(el, options = {}) {
    const items = el.querySelectorAll(options.itemSelector || '[data-sortable-item]');
    let draggedElement = null;

    items.forEach(item => {
        item.draggable = true;
        
        item.addEventListener('dragstart', function(e) {
            draggedElement = this;
            this.style.opacity = '0.4';
            e.dataTransfer.effectAllowed = 'move';
        });

        item.addEventListener('dragend', function(e) {
            this.style.opacity = '';
        });

        item.addEventListener('dragover', function(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            
            if (draggedElement !== this) {
                const rect = this.getBoundingClientRect();
                const midpoint = rect.top + rect.height / 2;
                
                if (e.clientY < midpoint) {
                    this.parentNode.insertBefore(draggedElement, this);
                } else {
                    this.parentNode.insertBefore(draggedElement, this.nextSibling);
                }
            }
            
            return false;
        });

        item.addEventListener('drop', function(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            if (options.onEnd) {
                options.onEnd({
                    item: draggedElement,
                    from: draggedElement.parentNode,
                    to: this.parentNode
                });
            }
            
            return false;
        });
    });

    return {
        destroy: function() {
            items.forEach(item => {
                item.draggable = false;
            });
        }
    };
};
